<!-- hadoop fs -mkdir -p warehouse/retail_edw/share/workflows  -->
<!-- copy sqoop-site.xml to above path -->

<workflow-app name="online-store-wf"
	xmlns="uri:oozie:workflow:0.5">
	<start to="sqoopImportDepartments"/>

	

	<action name="sqoopImportDepartments">
		<sqoop
			xmlns="uri:oozie:sqoop-action:0.2">
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<job-xml>${nameNode}/user/${wf:user()}/warehouse/retail_edw/share/workflows/sqoop-site.xml</job-xml>
			<arg>job</arg>
			<arg>--exec</arg>
			<arg>departments_pull</arg>
			<arg>--</arg>
			<arg>--target-dir</arg>
			<arg>${nameNode}/user/${wf:user()}/warehouse/retail_edw/retail_stage/departments/imported_date=${year}-${month}-${day}</arg>
		</sqoop>
		<ok to="sqoopImportCategories"/>
		<error to="Kill"/>
	</action>

	<action name="sqoopImportCategories">
		<sqoop
			xmlns="uri:oozie:sqoop-action:0.2">
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<job-xml>${nameNode}/user/${wf:user()}/warehouse/retail_edw/share/workflows/sqoop-site.xml</job-xml>
			<arg>job</arg>
			<arg>--exec</arg>
			<arg>categories_pull</arg>
			<arg>--</arg>
			<arg>--target-dir</arg>
			<arg>${nameNode}/user/${wf:user()}/warehouse/retail_edw/retail_stage/categories/imported_date=${year}-${month}-${day}</arg>
		</sqoop>
		<ok to="sqoopImportProducts"/>
		<error to="Kill"/>
	</action>


	<action name="sqoopImportProducts">
		<sqoop
			xmlns="uri:oozie:sqoop-action:0.2">
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<job-xml>${nameNode}/user/${wf:user()}/warehouse/retail_edw/share/workflows/sqoop-site.xml</job-xml>
			<arg>job</arg>
			<arg>--exec</arg>
			<arg>products_pull</arg>
			<arg>--</arg>
			<arg>--target-dir</arg>
			<arg>${nameNode}/user/${wf:user()}/warehouse/retail_edw/retail_stage/products/imported_date=${year}-${month}-${day}</arg>
		</sqoop>
		<ok to="sqoopImportCustomers"/>
		<error to="Kill"/>
	</action>

	<action name="sqoopImportCustomers">
		<sqoop
			xmlns="uri:oozie:sqoop-action:0.2">
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<job-xml>${nameNode}/user/${wf:user()}/warehouse/retail_edw/share/workflows/sqoop-site.xml</job-xml>
			<arg>job</arg>
			<arg>--exec</arg>
			<arg>customers_pull</arg>
			<arg>--</arg>
			<arg>--target-dir</arg>
			<arg>${nameNode}/user/${wf:user()}/warehouse/retail_edw/retail_stage/customers/imported_date=${year}-${month}-${day}</arg>
		</sqoop>
		<ok to="sqoopImportOrders"/>
		<error to="Kill"/>
	</action>


	<action name="sqoopImportOrders">
		<sqoop
			xmlns="uri:oozie:sqoop-action:0.2">
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<job-xml>${nameNode}/user/${wf:user()}/warehouse/retail_edw/share/workflows/sqoop-site.xml</job-xml>
			<arg>job</arg>
			<arg>--exec</arg>
			<arg>orders_pull</arg>
			<arg>--</arg>
			<arg>--target-dir</arg>
			<arg>${nameNode}/user/${wf:user()}/warehouse/retail_edw/retail_stage/orders/imported_date=${year}-${month}-${day}</arg>
		</sqoop>
		<ok to="sqoopImportOrderItems"/>
		<error to="Kill"/>
	</action>



	<action name="sqoopImportOrderItems">
		<sqoop
			xmlns="uri:oozie:sqoop-action:0.2">
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<job-xml>${nameNode}/user/${wf:user()}/warehouse/retail_edw/share/workflows/sqoop-site.xml</job-xml>
			<arg>job</arg>
			<arg>--exec</arg>
			<arg>order_items_pull</arg>
			<arg>--</arg>
			<arg>--target-dir</arg>
			<arg>${nameNode}/user/${wf:user()}/warehouse/retail_edw/retail_stage/order_items/imported_date=${year}-${month}-${day}</arg>
		</sqoop>
		<ok to="end"/>
		<error to="Kill"/>
	</action>

	

	<kill name="Kill">
		<message>Action failed, error message[${wf:errorMessage(wf:lastErrorNode())}]</message>
	</kill>
	<end name="end"/>
</workflow-app>
